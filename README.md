# System ZarzƒÖdzania BibliotekƒÖ (Library System)

Nowoczesny system do zarzƒÖdzania zasobami bibliotecznymi i wypo≈ºyczeniami, zbudowany z wykorzystaniem Spring Boot, Spring Security, JPA/Hibernate oraz PostgreSQL, konteneryzowany przy u≈ºyciu Docker.

---

## üìã Spis tre≈õci

1.  [üéØ Opis projektu](#opis-projektu)
2.  [‚ú® Kluczowe funkcjonalno≈õci](#kluczowe-funkcjonalnosci)
3.  [üèóÔ∏è Architektura i wzorce projektowe](#architektura-i-wzorce-projektowe)
    * [Wzorce projektowe](#wzorce-projektowe)
    * [Polimorfizm](#polimorfizm)
4.  [üîê System autoryzacji (RBAC)](#system-autoryzacji-rbac)
    * [Role u≈ºytkownik√≥w](#role-uzytkownikow)
    * [Implementacja bezpiecze≈Ñstwa](#implementacja-bezpieczenstwa)
5.  [üöÄ Technologie](#technologie)
6.  [üê≥ Szybki start z Docker](#szybki-start-z-docker)
7.  [üìö Dokumentacja API (Swagger)](#dokumentacja-api-swagger)
8.  [üóÑÔ∏è Model bazy danych (ERD)](#model-bazy-danych-erd)
9.  [üîß Konfiguracja](#konfiguracja)
10. [üß™ Testowanie](#testowanie)
11. [üì∏ Zrzuty ekranu](#zrzuty-ekranu) 

---

## üéØ Opis projektu

**System ZarzƒÖdzania BibliotekƒÖ** to aplikacja webowa umo≈ºliwiajƒÖca efektywne zarzƒÖdzanie zbiorami ksiƒÖ≈ºek, procesem ich wypo≈ºyczania oraz u≈ºytkownikami systemu. Aplikacja zosta≈Ça zaprojektowana z my≈õlƒÖ o modularno≈õci, bezpiecze≈Ñstwie i ≈Çatwo≈õci obs≈Çugi, zgodnie z zasadami programowania obiektowego i SOLID.

---

## ‚ú® Kluczowe funkcjonalno≈õci

* **üë§ ZarzƒÖdzanie u≈ºytkownikami:**
    * Rejestracja nowych u≈ºytkownik√≥w.
    * Logowanie u≈ºytkownik√≥w.
    * System r√≥l (U≈ºytkownik, Administrator).
* **üìö Katalog ksiƒÖ≈ºek:**
    * Dodawanie, edycja, usuwanie ksiƒÖ≈ºek (Admin).
    * PrzeglƒÖdanie i wyszukiwanie ksiƒÖ≈ºek (Wszyscy zalogowani).
* **üé´ ZarzƒÖdzanie wypo≈ºyczeniami:**
    * Wypo≈ºyczanie ksiƒÖ≈ºek przez u≈ºytkownik√≥w.
    * Zwracanie ksiƒÖ≈ºek.
    * PrzeglƒÖdanie historii wypo≈ºycze≈Ñ (w≈Çasnych dla User, wszystkich dla Admin).

---

## üèóÔ∏è Architektura i wzorce projektowe

Projekt zosta≈Ç zbudowany zgodnie z **filarami obiektowo≈õci** i **zasadami SOLID**. Zastosowano standardowƒÖ architekturƒô warstwowƒÖ typowƒÖ dla aplikacji Spring Boot (Kontrolery, Serwisy, Repozytoria).

### Wzorce projektowe

1.  **Wzorzec Strategia (Strategy Pattern)** üéØ
    * **Lokalizacja:** `com.example.librarysystem.service.policy.LoanPolicy` (interfejs) oraz jego implementacje `StandardLoanPolicy` i `AcademicLoanPolicy`.
    * **Opis:** Wzorzec Strategia zosta≈Ç u≈ºyty do zdefiniowania r√≥≈ºnych polityk obliczania terminu zwrotu ksiƒÖ≈ºki. `BorrowingService` korzysta z wstrzykniƒôtej implementacji `LoanPolicy` do elastycznego okre≈õlania daty zwrotu, co pozwala na ≈Çatwe dodawanie nowych polityk wypo≈ºycze≈Ñ bez modyfikacji samego serwisu. Wym√≥g u≈ºycia wzorca projektowego jest spe≈Çniony.

    ```java
    // Interfejs LoanPolicy
    public interface LoanPolicy {
        LocalDate calculateDueDate(LocalDate borrowDate, Book book, User user);
    }

    // Implementacja StandardLoanPolicy
    @Component("standardLoanPolicy")
    public class StandardLoanPolicy implements LoanPolicy {
        private static final int STANDARD_LOAN_DURATION_DAYS = 14;
        @Override
        public LocalDate calculateDueDate(LocalDate borrowDate, Book book, User user) {
            return borrowDate.plusDays(STANDARD_LOAN_DURATION_DAYS);
        }
    }
    ```

2.  **Wzorzec Budowniczy (Builder Pattern) w Spring Security** üõ†Ô∏è
    * **Opis:** Konfiguracja obiektu `HttpSecurity` w klasie `SecurityConfig` odbywa siƒô poprzez ≈Ça≈Ñcuch wywo≈Ça≈Ñ metod (tzw. fluent API), co jest charakterystyczne dla wzorca Budowniczego. Jest to mechanizm dostarczany przez sam framework Spring Security, umo≈ºliwiajƒÖcy czytelne i krokowe definiowanie regu≈Ç bezpiecze≈Ñstwa.
        ```java
        // Fragment SecurityConfig.java demonstrujƒÖcy wzorzec Budowniczy
        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/api/users/register").permitAll()
                // ... dalsze konfiguracje ...
            )
            .formLogin(formLogin -> formLogin /* ... */);
        ```
    * Dodatkowo, sam framework Spring Security wewnƒôtrznie wykorzystuje inne wzorce, takie jak ≈Åa≈Ñcuch Odpowiedzialno≈õci (dla filtr√≥w) czy Strategia (dla mechanizm√≥w uwierzytelniania), co przyczynia siƒô do jego elastyczno≈õci.

### Polimorfizm

System wykorzystuje **polimorfizm** poprzez interfejs `LoanPolicy`. Serwis `BorrowingService` operuje na abstrakcji `LoanPolicy`, a konkretne zachowanie (spos√≥b obliczania daty zwrotu) jest determinowane przez rzeczywisty typ obiektu (np. `StandardLoanPolicy`, `AcademicLoanPolicy`) wstrzykniƒôty w czasie dzia≈Çania aplikacji. To r√≥wnie≈º spe≈Çnia wym√≥g implementacji polimorfizmu w projekcie.

```java
// W BorrowingService
private final LoanPolicy loanPolicy;

public BorrowingService(/*...*/, @Qualifier("standardLoanPolicy") LoanPolicy loanPolicy) {
    this.loanPolicy = loanPolicy;
}

public Borrowing borrowBook(Long userId, Long bookId) {
    // ...
    LocalDate dueDate = this.loanPolicy.calculateDueDate(borrowDate, book, user); // Wykorzystanie polimorfizmu
    // ...
}
```

## üîê System autoryzacji (RBAC)

System implementuje **Role-Based Access Control** z dwoma g≈Ç√≥wnymi rolami u≈ºytkownik√≥w.

### Role u≈ºytkownik√≥w

| Rola         | Opis                | G≈Ç√≥wne Uprawnienia                                                                                                                                  |
| :----------- | :------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ROLE_USER`  | Zwyk≈Çy u≈ºytkownik   | ‚Ä¢ PrzeglƒÖdanie ksiƒÖ≈ºek <br>‚Ä¢ Wypo≈ºyczanie i zwracanie ksiƒÖ≈ºek <br>‚Ä¢ PrzeglƒÖdanie w≈Çasnej historii wypo≈ºycze≈Ñ                                              |
| `ROLE_ADMIN` | Administrator systemu | ‚Ä¢ Wszystkie uprawnienia `ROLE_USER` <br>‚Ä¢ ZarzƒÖdzanie katalogiem ksiƒÖ≈ºek (dodawanie, edycja, usuwanie) <br>‚Ä¢ ZarzƒÖdzanie u≈ºytkownikami <br>‚Ä¢ PrzeglƒÖdanie wszystkich wypo≈ºycze≈Ñ  |

### Implementacja bezpiecze≈Ñstwa

Bezpiecze≈Ñstwo aplikacji oparte jest na Spring Security. Konfiguracja znajduje siƒô w klasie `com.example.librarysystem.config.SecurityConfig`.
Logowanie odbywa siƒô poprzez standardowy formularz Spring Security.

```java
// Fragment SecurityConfig.java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(authz -> authz
                        .requestMatchers("/api/users/register").permitAll() // Pozwala na dostƒôp do rejestracji dla wszystkich
                        .requestMatchers("/swagger-ui/**", "/v3/api-docs/**", "/swagger-ui.html").permitAll() // Pozwala na dostƒôp do Swagger UI dla wszystkich
                        .requestMatchers(HttpMethod.GET, "/api/books", "/api/books/**").hasAnyRole("USER", "ADMIN") // Dostƒôp do ksiƒÖ≈ºek dla USER i ADMIN
                        .requestMatchers("/api/borrowings/borrow", "/api/borrowings/**/return").hasAnyRole("USER", "ADMIN") // Wypo≈ºyczanie i zwrot dla USER i ADMIN
                        .requestMatchers("/api/borrowings/user/**").hasAnyRole("USER", "ADMIN") // Historia wypo≈ºycze≈Ñ u≈ºytkownika dla USER i ADMIN
                        .requestMatchers(HttpMethod.POST, "/api/books").hasRole("ADMIN") // Dodawanie ksiƒÖ≈ºek tylko dla ADMIN
                        .requestMatchers(HttpMethod.PUT, "/api/books/**").hasRole("ADMIN") // Aktualizacja ksiƒÖ≈ºek tylko dla ADMIN
                        .requestMatchers(HttpMethod.DELETE, "/api/books/**").hasRole("ADMIN") // Usuwanie ksiƒÖ≈ºek tylko dla ADMIN
                        .requestMatchers("/api/users/**").hasRole("ADMIN") // ZarzƒÖdzanie u≈ºytkownikami (opr√≥cz /register) tylko dla ADMIN
                        .requestMatchers("/api/borrowings").hasRole("ADMIN") // Wszystkie wypo≈ºyczenia tylko dla ADMIN
                        .anyRequest().authenticated() // Wszystkie inne ≈ºƒÖdania wymagajƒÖ uwierzytelnienia
                )
                .formLogin(formLogin -> formLogin
                        .defaultSuccessUrl("/swagger-ui.html", true) // Przekierowanie po udanym logowaniu
                        .permitAll() // Strona logowania dostƒôpna dla wszystkich
                )
                .logout(logout -> logout
                        .logoutSuccessUrl("/?logout=true") // Przekierowanie po wylogowaniu
                        .permitAll() // Strona wylogowania dostƒôpna dla wszystkich
                );
        return http.build();
    }
}
```
---

## üöÄ Technologie

**Backend Stack:**
* Java 21
* Spring Boot 3.3.0
* Spring Security 6
* Spring Data JPA
* Hibernate
* Lombok

**Baza danych:**
* PostgreSQL 15
* Flyway (do zarzƒÖdzania migracjami schematu bazy danych)
* HikariCP (pula po≈ÇƒÖcze≈Ñ)

**Narzƒôdzia DevOps & Budowanie:**
* Docker & Docker Compose (konteneryzacja aplikacji i bazy danych)
* Maven (zarzƒÖdzanie zale≈ºno≈õciami i procesem budowania)

**Dokumentacja & Testowanie:**
* SpringDoc OpenAPI (Swagger UI) (interaktywna dokumentacja API)
* JUnit 5 (testy jednostkowe i integracyjne)
* Mockito (mockowanie w testach jednostkowych)
* Testcontainers (testy integracyjne z prawdziwƒÖ bazƒÖ PostgreSQL w kontenerze)
* JaCoCo (analiza pokrycia kodu testami)

---

## üê≥ Szybki start z Docker

**Wymagania:**
* JDK 21 lub nowsze (do budowania projektu Mavenem)
* Maven 3.6+ (do budowania projektu)
* Docker Desktop (do uruchamiania kontener√≥w)
* Docker Compose

**Uruchomienie:**

1.  Zbuduj projekt za pomocƒÖ Mavena (tworzy plik JAR):
    ```bash
    mvn clean install
    ```
2.  Uruchom ca≈Çy stos aplikacji (aplikacja + baza danych) za pomocƒÖ Docker Compose:
    ```bash
    docker-compose up --build
    ```
    Flaga `--build` wymusza przebudowanie obrazu aplikacji, je≈õli zasz≈Çy zmiany.

**Dostƒôp do aplikacji:**
* API bƒôdzie dostƒôpne pod adresem: `http://localhost:8080`
* Dokumentacja Swagger UI: `http://localhost:8080/swagger-ui.html`
* Baza danych PostgreSQL (je≈õli potrzebujesz siƒô po≈ÇƒÖczyƒá z zewnƒÖtrz): `localhost:5432` (u≈ºytkownik: `postgres`, has≈Ço: `admin` - zgodnie z `docker-compose.yml`)

**Pierwsze kroki:**
1.  Otw√≥rz Swagger UI: `http://localhost:8080/swagger-ui.html`
2.  Zarejestruj nowego u≈ºytkownika u≈ºywajƒÖc endpointu `POST /api/users/register`.
    Przyk≈Çadowe cia≈Ço ≈ºƒÖdania:
    ```json
    {
      "username": "user",
      "password": "user",
      "role": "ROLE_USER"
    }
    ```
    Lub dla admina:
    ```json
    {
      "username": "admin",
      "password": "admin",
      "role": "ROLE_ADMIN"
    }
    ```
3.  U≈ºyj danych nowo utworzonego u≈ºytkownika, aby zalogowaƒá siƒô przez formularz Spring Security (domy≈õlnie `http://localhost:8080/login`, na kt√≥ry zostaniesz przekierowany pr√≥bujƒÖc uzyskaƒá dostƒôp do zabezpieczonego zasobu). Po zalogowaniu zostaniesz przekierowany na `/swagger-ui.html`.
4.  Mo≈ºesz teraz testowaƒá inne endpointy API wymagajƒÖce autoryzacji.

---

## üìö Dokumentacja API (Swagger)

Interaktywna dokumentacja API jest dostƒôpna pod adresem `http://localhost:8080/swagger-ui.html` po uruchomieniu aplikacji. Opisuje ona wszystkie dostƒôpne endpointy, ich parametry, oczekiwane cia≈Ça ≈ºƒÖda≈Ñ oraz mo≈ºliwe odpowiedzi. Zosta≈Ça zaimplementowana przy u≈ºyciu SpringDoc OpenAPI.

**G≈Ç√≥wne modu≈Çy API:**
* `/api/users`: ZarzƒÖdzanie u≈ºytkownikami (rejestracja, pobieranie danych).
* `/api/books`: ZarzƒÖdzanie ksiƒÖ≈ºkami (CRUD, przeglƒÖdanie).
* `/api/borrowings`: ZarzƒÖdzanie wypo≈ºyczeniami (tworzenie wypo≈ºyczenia, zwrot, historia).

---

## üóÑÔ∏è Model bazy danych (ERD)

Schemat bazy danych jest zarzƒÖdzany przez Flyway. Pierwsza migracja (`V1__Create_base_tables.sql`) tworzy nastƒôpujƒÖce tabele: `library_users`, `book`, `borrowings` wraz z ich relacjami.

*(Tutaj wstaw sw√≥j wygenerowany diagram ERD jako obrazek. Mo≈ºesz go umie≈õciƒá w repozytorium np. w folderze `docs/images/` i podlinkowaƒá. Upewnij siƒô, ≈ºe ≈õcie≈ºka jest poprawna, np.:)*

---

## üîß Konfiguracja

G≈Ç√≥wne pliki konfiguracyjne projektu:

* **`application.properties`**:
    * Zawiera podstawowƒÖ konfiguracjƒô aplikacji Spring Boot.
    * Definiuje placeholdery dla danych dostƒôpowych do bazy danych (np. `${SPRING_DATASOURCE_URL}`), kt√≥re sƒÖ dostarczane przez zmienne ≈õrodowiskowe podczas uruchamiania z Docker Compose.
    * Ustawia `spring.jpa.hibernate.ddl-auto` na `validate` (lub warto≈õƒá domy≈õlnƒÖ przekazanƒÖ przez zmiennƒÖ ≈õrodowiskowƒÖ), co oznacza, ≈ºe Hibernate weryfikuje zgodno≈õƒá schematu bazy danych (stworzonego przez Flyway) z encjami JPA.
    * Konfiguruje `spring.flyway.enabled=true`, aby aktywowaƒá zarzƒÖdzanie migracjami bazy danych przez Flyway.

* **`docker-compose.yml`**:
    * Definiuje serwisy Dockerowe dla aplikacji (`app`) oraz bazy danych PostgreSQL (`db`).
    * Okre≈õla obrazy Dockerowe, mapowania port√≥w (np. `8080:8080` dla aplikacji, `5432:5432` dla bazy danych).
    * Ustawia zmienne ≈õrodowiskowe dla kontenera aplikacji, w tym dane dostƒôpowe do bazy danych (`SPRING_DATASOURCE_URL=jdbc:postgresql://db:5432/library_system_db`, `SPRING_DATASOURCE_USERNAME`, `SPRING_DATASOURCE_PASSWORD`) oraz `SPRING_JPA_HIBERNATE_DDL_AUTO=validate`.
    * Definiuje wolumen (`postgres_data`) dla persystencji danych bazy PostgreSQL.
    * Zawiera konfiguracjƒô `healthcheck` dla serwisu bazy danych.

* **`src/main/resources/db/migration/`**:
    * Katalog zawierajƒÖcy skrypty migracyjne SQL zarzƒÖdzane przez Flyway. Ka≈ºdy skrypt jest nazwany zgodnie z konwencjƒÖ Flyway (np. `V1__Create_base_tables.sql`) i odpowiada za kolejne zmiany w schemacie bazy danych.

---

## üß™ Testowanie

Projekt wykorzystuje JUnit 5, Mockito oraz Testcontainers do zapewnienia jako≈õci kodu i weryfikacji funkcjonalno≈õci.

* **Testy jednostkowe:**
    * ZnajdujƒÖ siƒô w `src/test/java` (zazwyczaj bez specjalnego sufiksu lub z sufiksem `Test`).
    * TestujƒÖ logikƒô poszczeg√≥lnych komponent√≥w (g≈Ç√≥wnie klas serwisowych) w izolacji.
    * Zale≈ºno≈õci sƒÖ mockowane przy u≈ºyciu biblioteki Mockito.

* **Testy integracyjne:**
    * R√≥wnie≈º znajdujƒÖ siƒô w `src/test/java` (zazwyczaj z sufiksem `IT`, np. `BookControllerIT`).
    * TestujƒÖ wsp√≥≈Çpracƒô wielu komponent√≥w aplikacji, w tym endpointy API, interakcjƒô z warstwƒÖ serwisowƒÖ oraz bazƒÖ danych.
    * WykorzystujƒÖ Testcontainers do uruchamiania instancji bazy danych PostgreSQL w kontenerze Docker na potrzeby test√≥w, co zapewnia sp√≥jne i izolowane ≈õrodowisko testowe.
    * Do testowania endpoint√≥w MVC wykorzystywany jest `MockMvc`, a Spring Security Test pomaga w weryfikacji regu≈Ç bezpiecze≈Ñstwa.

**Uruchamianie test√≥w:**
* Aby zbudowaƒá projekt, uruchomiƒá wszystkie testy (jednostkowe i integracyjne) oraz wygenerowaƒá raporty pokrycia kodu:
    ```bash
    mvn clean verify
    ```

**Pokrycie kodu (JaCoCo):**
* Raporty pokrycia kodu generowane przez JaCoCo sƒÖ dostƒôpne po wykonaniu `mvn clean verify` (lub `mvn clean install`) w katalogu:
    * `target/site/jacoco-ut/index.html` (dla test√≥w jednostkowych)
    * `target/site/jacoco-it/index.html` (dla test√≥w integracyjnych)
    * *(Mo≈ºesz te≈º skonfigurowaƒá zagregowany raport w `target/site/jacoco/index.html`)*
* **Cel projektu:** OsiƒÖgniƒôcie co najmniej 80% pokrycia kodu testami.
* **Aktualne pokrycie kodu testami:** *(Wstaw tutaj swoje aktualne pokrycie, np. "Ca≈Çkowite pokrycie instrukcji: XX%, pokrycie ga≈Çƒôzi: YY% (na podstawie raport√≥w JaCoCo-UT i JaCoCo-IT)")*

---

## üì∏ Zrzuty ekranu

Poni≈ºej znajdujƒÖ siƒô przyk≈Çadowe zrzuty ekranu prezentujƒÖce dzia≈Çanie aplikacji.

* **Strona g≈Ç√≥wna Swagger UI:**
    *(Tutaj umie≈õƒá zrzut ekranu g≈Ç√≥wnego widoku Swagger UI, pokazujƒÖcy listƒô dostƒôpnych kontroler√≥w/endpoint√≥w)*
    `![Swagger UI - Strona g≈Ç√≥wna](docs/images/swagger_ui_main.png "Strona g≈Ç√≥wna Swagger UI")`

* **Przyk≈Çadowy endpoint w Swagger UI (np. lista ksiƒÖ≈ºek):**
    *(Tutaj umie≈õƒá zrzut ekranu rozwiniƒôtego endpointu w Swagger UI, np. GET /api/books, z widocznymi parametrami i przyk≈ÇadowƒÖ odpowiedziƒÖ)*
    `![Swagger UI - Lista ksiƒÖ≈ºek](docs/images/swagger_ui_books_list.png "Przyk≈Çad endpointu /api/books w Swagger UI")`

* **Formularz logowania Spring Security:**
    *(Tutaj umie≈õƒá zrzut ekranu strony logowania, kt√≥ra pojawia siƒô przy pr√≥bie dostƒôpu do zabezpieczonego zasobu)*
    `![Formularz logowania](docs/images/login_form.png "Formularz logowania Spring Security")`

* **Przyk≈Çadowa odpowied≈∫ API (np. z Postmana lub Swaggera):**
    *(Tutaj umie≈õƒá zrzut ekranu pokazujƒÖcy przyk≈ÇadowƒÖ odpowied≈∫ JSON z jednego z Twoich endpoint√≥w, np. szczeg√≥≈Çy ksiƒÖ≈ºki lub dane u≈ºytkownika)*
    `![Przyk≈Çadowa odpowied≈∫ API](docs/images/api_response_example.png "Przyk≈Çadowa odpowied≈∫ JSON z API")`

* ** Widok bazy danych:** <br>
    ![Widok bazy danych](images/photo7.png "Widok bazy danych")

---



